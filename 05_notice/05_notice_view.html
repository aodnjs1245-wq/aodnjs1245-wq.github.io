<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>서환산업 | 공지사항 상세</title>
<!-- 공통 -->
<link rel="stylesheet" href="/css/01_common.css">
<!-- 페이지별 -->
<link rel="stylesheet" href="/css/02_pages.css">
</head>
<body>
  
 <!-- ===== 공통 헤더 삽입 영역 ===== -->
<div id="app-header"></div>

  <div class="notice-view-wrap">

    <div class="notice-view-box">
      
      <!-- 제목 -->
      <h2 class="notice-view-title" id="noticeTitle"></h2>

      <!-- 작성일 -->
      <div class="notice-view-meta">
         작성일 : <span id="noticeDate"></span>
      </div>
      <!-- 본문 -->
      <div class="notice-view-content" id="noticeContent"></div>

      <!-- 목록 버튼 -->
      <div class="notice-view-btn">
        <a href="/05_notice/05_notice.html">목록으로 돌아가기</a>
      </div>

    </div>

  </div>

<!-- ===== 공통 푸터 삽입 영역 ===== -->
<div id="app-footer"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/01_supabase.js"></script>
<script src="/js/00_common.js"></script>

<script>
/* =========================
   공지 상세 렌더
========================= */
function formatDate(iso){
  const d = new Date(iso);
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${y}-${m}-${day}`;
}

document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(location.search);
  const id = params.get("id");

  const elTitle = document.getElementById("noticeTitle");
  const elDate = document.getElementById("noticeDate");
  const elContent = document.getElementById("noticeContent");

  if (!id){
    elTitle.textContent = "잘못된 접근입니다.";
    elDate.textContent = "";
    elContent.textContent = "공지 ID가 없습니다.";
    return;
  }

  const { data, error } = await window.supabaseClient
    .from("notices")
    .select("title, content, created_at")
    .eq("id", Number(id))
    .single();

  if (error || !data){
    console.error(error);
    elTitle.textContent = "공지사항을 불러오지 못했습니다.";
    elDate.textContent = "";
    elContent.textContent = "잠시 후 다시 시도해주세요.";
    return;
  }

  elTitle.textContent = data.title;
  elDate.textContent = formatDate(data.created_at);
  elContent.innerHTML = String(data.content).replaceAll("\n", "<br>");
});
</script>
</body>
</html>